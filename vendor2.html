<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendor Management Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- SheetJS for Excel Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Chosen Palette: Professional Blue & Slate -->
    <!-- Application Structure Plan: The application now integrates Firebase Firestore for real-time, multi-user data persistence. The structure is a dashboard with a modal for data entry. All CRUD (Create, Read, Update, Delete) operations are now asynchronous calls to Firestore. This replaces localStorage, making it a true web app. Anonymous authentication is used for simplicity and security. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Vendor data persistence. Goal: Multi-user, real-time data. Viz/Method: Firebase Firestore integration. Justification: This is the core requirement for making the app's data accessible across the website for all users. It uses onSnapshot for real-time updates. Library/Method: Firebase SDK.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
        }
        /* Fixed Toggle CSS */
        .toggle-bg {
            position: relative;
            display: block;
            width: 2.75rem; /* w-11 */
            height: 1.5rem; /* h-6 */
            border-radius: 9999px;
            background-color: #e5e7eb; /* gray-200 */
            transition: background-color 0.2s ease-in-out;
        }
        .toggle-bg:after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            background-color: white;
            border-radius: 9999px;
            height: 1.25rem; /* h-5 */
            width: 1.25rem; /* w-5 */
            transition: transform 0.2s ease-in-out;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        input:checked + .toggle-bg {
            background-color: #2563eb; /* blue-600 */
        }
        input:checked + .toggle-bg:after {
            transform: translateX(100%);
        }
        /* Loading Spinner */
        #loading-overlay {
            background-color: rgba(241, 245, 249, 0.8);
        }
        .spinner {
            border-top-color: #3b82f6;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="spinner h-12 w-12 rounded-full border-4 border-slate-200"></div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">

        <header class="flex flex-col sm:flex-row justify-between items-start mb-8">
            <div>
                <h1 class="text-3xl font-bold text-slate-800">Vendor Dashboard</h1>
                <p class="text-slate-500 mt-1">Manage and contact your holiday planning vendors.</p>
            </div>
            <div class="flex flex-col sm:flex-row gap-2 mt-4 sm:mt-0 w-full sm:w-auto">
                 <button id="export-btn" class="inline-flex justify-center py-2 px-6 border border-slate-300 shadow-sm text-sm font-medium rounded-md text-slate-700 bg-white hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Export to Excel
                </button>
                <button id="open-modal-btn" class="inline-flex justify-center py-2 px-6 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Add New Vendor
                </button>
            </div>
        </header>

        <!-- Dashboard Stats -->
        <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
             <div class="bg-white p-6 rounded-xl shadow">
                <h3 class="text-sm font-medium text-slate-500">Total Vendors</h3>
                <p id="total-vendors-stat" class="text-3xl font-bold text-slate-800 mt-2">0</p>
            </div>
        </section>


        <!-- Vendor List Section -->
        <section id="vendor-list-section">
            <div id="vendor-list-container" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
                <!-- Vendor cards will be injected here -->
            </div>
            <div id="empty-state" class="text-center py-16 bg-white rounded-xl shadow hidden">
                <h3 class="text-xl font-semibold text-slate-700">Your vendor list is empty.</h3>
                <p class="text-slate-500 mt-2">Click "Add New Vendor" to get started.</p>
            </div>
        </section>

    </div>

    <!-- Add Vendor Modal -->
    <div id="vendor-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50 p-4">
        <div class="relative bg-white rounded-2xl shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col">
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-6 border-b border-slate-200">
                <h2 class="text-2xl font-bold text-blue-800">Add New Vendor</h2>
                <button id="close-modal-btn" class="text-slate-400 hover:text-slate-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <!-- Modal Body -->
            <div class="p-6 overflow-y-auto">
                <form id="add-vendor-form">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                         <!-- Left Column -->
                        <div class="space-y-6">
                            <div>
                                <label for="vendorName" class="block text-sm font-medium text-slate-700">Vendor Name</label>
                                <input type="text" id="vendorName" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label for="cityZone" class="block text-sm font-medium text-slate-700">City / Zone</label>
                                <input type="text" id="cityZone" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500" required>
                            </div>
                             <div>
                                <label for="contactNumber" class="block text-sm font-medium text-slate-700">Contact Number (for Call)</label>
                                <input type="tel" id="contactNumber" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                            </div>
                             <div>
                                <label for="whatsappNumber" class="block text-sm font-medium text-slate-700">WhatsApp Number</label>
                                <input type="tel" id="whatsappNumber" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                            </div>
                             <!-- Company Info -->
                            <div class="space-y-4 pt-2">
                                <h3 class="text-md font-semibold text-slate-800 border-b pb-2">Company Information</h3>
                                <div class="flex items-center justify-between">
                                    <label for="yearOfEstablishment" class="text-sm font-medium text-slate-700">Year of Establishment</label>
                                    <input type="number" id="yearOfEstablishment" placeholder="e.g., 2010" class="w-1/2 mt-1 block px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-slate-700">GST Registered?</span>
                                    <label class="flex items-center cursor-pointer">
                                        <div class="relative">
                                            <input type="checkbox" id="isGstRegistered" class="sr-only">
                                            <div class="toggle-bg"></div>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>

                         <!-- Right Column -->
                        <div class="space-y-6">
                             <!-- Fleet Info -->
                            <div class="space-y-4">
                                <h3 class="text-md font-semibold text-slate-800 border-b pb-2">Fleet Details</h3>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-slate-700">Owns Fleet?</span>
                                    <label class="flex items-center cursor-pointer">
                                        <div class="relative">
                                            <input type="checkbox" id="hasOwnFleet" class="sr-only">
                                            <div class="toggle-bg"></div>
                                        </div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <label for="vehicleCount" class="text-sm font-medium text-slate-700">Total No. of Vehicles</label>
                                    <input type="number" id="vehicleCount" placeholder="e.g., 25" class="w-1/2 mt-1 block px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                                </div>
                            </div>
                            <!-- Vehicle Types -->
                            <div class="space-y-4">
                                <h3 class="text-md font-semibold text-slate-800 border-b pb-2">Vehicle Types & Count</h3>
                                <div id="vehicle-types-container" class="space-y-2">
                                    <!-- Dynamic vehicles here -->
                                </div>
                                <div class="flex gap-2 items-center pt-2">
                                    <input type="text" id="customVehicleName" placeholder="Custom Type (e.g., Minibus)" class="flex-grow block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                                    <input type="number" id="customVehicleCount" placeholder="No." class="w-16 block px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                                    <button type="button" id="add-custom-vehicle-btn" class="px-3 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">+</button>
                                </div>
                                <div id="custom-vehicle-tags" class="flex flex-wrap gap-2 mt-2"></div>
                            </div>
                              <!-- Notes -->
                             <div class="pt-4">
                                <label for="notes" class="block text-sm font-medium text-slate-700">Notes / Red Flags</label>
                                <textarea id="notes" rows="4" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"></textarea>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
             <!-- Modal Footer -->
            <div class="flex justify-end items-center p-6 border-t border-slate-200">
                 <button type="submit" form="add-vendor-form" class="inline-flex justify-center py-2 px-6 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Save Vendor</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAZ0eDXO8mGWJG9b5-F_eUqYnCmGnhJzkk",
            authDomain: "vendor-manager-a8ede.firebaseapp.com",
            projectId: "vendor-manager-a8ede",
            storageBucket: "vendor-manager-a8ede.appspot.com",
            messagingSenderId: "689330927875",
            appId: "1:689330927875:web:e52e9cb02132dab4af5136"
        };
        
        let db;
        let vendorsCollection;
        let vendors = []; // This will be a local copy for the export function

        try {
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            db = getFirestore(app);

            // Sign in anonymously to secure database access
            await signInAnonymously(auth);
            
            vendorsCollection = collection(db, "vendors");
            listenForVendors();

        } catch (error) {
            console.error("Firebase initialization error:", error);
            const loadingOverlay = document.getElementById('loading-overlay');
            
            let errorMessage = `<div class="text-center p-4 bg-red-100 text-red-700 rounded-lg max-w-lg mx-auto">
                <p class="font-bold">Firebase Connection Failed</p>`;

            if (error.code === 'auth/configuration-not-found') {
                errorMessage += `<p class="text-sm mt-2"><b>Action Required:</b> You need to enable Anonymous Sign-In in your Firebase project.</p>
                <ol class="text-left text-sm mt-2 list-decimal list-inside">
                    <li>Go to the Firebase Console.</li>
                    <li>Select your project ('vendor-manager-a8ede').</li>
                    <li>Click <b>Build > Authentication</b> in the left menu.</li>
                    <li>Go to the <b>Sign-in method</b> tab.</li>
                    <li>Find "Anonymous" in the list and enable it.</li>
                </ol>
                <p class="text-sm mt-2">After enabling it, refresh this page.</p>`;
            } else {
                 errorMessage += `<p class="text-sm mt-2">Please make sure you have pasted your Firebase config correctly and check the browser console for more details.</p>`;
            }
             errorMessage += `</div>`;
             loadingOverlay.innerHTML = errorMessage;
        }

        const addVendorForm = document.getElementById('add-vendor-form');
        const vendorListContainer = document.getElementById('vendor-list-container');
        const emptyState = document.getElementById('empty-state');
        const vendorModal = document.getElementById('vendor-modal');
        const openModalBtn = document.getElementById('open-modal-btn');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const exportBtn = document.getElementById('export-btn');
        const loadingOverlay = document.getElementById('loading-overlay');
        
        const totalVendorsStat = document.getElementById('total-vendors-stat');

        const vehicleTypesContainer = document.getElementById('vehicle-types-container');
        const addCustomVehicleBtn = document.getElementById('add-custom-vehicle-btn');
        const customVehicleTagsContainer = document.getElementById('custom-vehicle-tags');
        
        let tempCustomVehicles = [];
        const standardVehicleTypes = ['Sedan', 'SUV', 'Ertiga', 'Crysta', 'Tempo Traveller', 'Bus'];

        function listenForVendors() {
            onSnapshot(vendorsCollection, (snapshot) => {
                const fetchedVendors = [];
                snapshot.forEach((doc) => {
                    fetchedVendors.push({ ...doc.data(), id: doc.id });
                });
                vendors = fetchedVendors; // Update local copy for export
                renderVendors(vendors);
                loadingOverlay.classList.add('hidden');
            }, (error) => {
                console.error("Error fetching vendors: ", error);
                loadingOverlay.innerHTML = `<p class="text-red-600">Error fetching data. Check console and Firebase security rules.</p>`;
            });
        }
        
        const initializeVehicleForm = () => {
            vehicleTypesContainer.innerHTML = '';
            standardVehicleTypes.forEach(type => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between gap-2';
                div.innerHTML = `
                    <label class="text-sm text-slate-600">${type}</label>
                    <div class="flex items-center gap-2">
                        <label class="flex items-center cursor-pointer">
                            <div class="relative">
                                <input type="checkbox" data-type="${type}" class="sr-only vehicle-type-checkbox">
                                <div class="toggle-bg"></div>
                            </div>
                        </label>
                        <input type="number" data-type-count="${type}" placeholder="No." class="w-20 mt-1 block px-3 py-1 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500" disabled>
                    </div>
                `;
                vehicleTypesContainer.appendChild(div);
            });
            tempCustomVehicles = [];
            customVehicleTagsContainer.innerHTML = '';
        };

        const updateDashboardStats = (vendorList) => {
             totalVendorsStat.textContent = vendorList.length;
        };

        const renderVendors = (vendorList) => {
            vendorListContainer.innerHTML = '';
            if (vendorList.length === 0) {
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
                vendorList.forEach((vendor) => {
                    const vehicleListHTML = vendor.vehicleTypes && vendor.vehicleTypes.length > 0
                        ? vendor.vehicleTypes.map(v => `<li class="flex justify-between"><span>${v.type}</span><span class="font-medium bg-slate-100 px-2 rounded-md">${v.count}</span></li>`).join('')
                        : '<li class="text-slate-500">Not specified</li>';

                    const contactHTML = `
                        ${vendor.contactNumber ? `<a href="tel:${vendor.contactNumber}" class="text-blue-600 hover:underline">${vendor.contactNumber}</a>` : ''}
                        ${vendor.contactNumber && vendor.whatsappNumber ? `<span class="text-slate-400 mx-1">|</span>` : ''}
                        ${vendor.whatsappNumber ? `<a href="https://wa.me/${vendor.whatsappNumber.replace(/[^0-9]/g, '')}" target="_blank" class="text-green-600 hover:underline">${vendor.whatsappNumber} (WA)</a>` : ''}
                        ${!vendor.contactNumber && !vendor.whatsappNumber ? `<span class="text-slate-500">Not provided</span>` : ''}
                    `;

                    const card = `
                    <div class="bg-white p-6 rounded-xl shadow flex flex-col">
                        <div class="flex-grow">
                            <div class="mb-4">
                                <h3 class="text-lg font-bold text-slate-800">${vendor.vendorName}</h3>
                                <p class="text-sm text-slate-500">${vendor.cityZone}</p>
                                <p class="text-sm mt-2">${contactHTML}</p>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4 mb-4 text-sm">
                                <div class="space-y-2">
                                    <h4 class="font-semibold text-slate-600 border-b pb-1">Company</h4>
                                    <div class="flex justify-between"><span>Established:</span> <span class="font-semibold">${vendor.yearOfEstablishment || 'N/A'}</span></div>
                                    <div class="flex justify-between"><span>GST Registered:</span> <span class="font-semibold">${vendor.isGstRegistered ? 'Yes' : 'No'}</span></div>
                                </div>
                                <div class="space-y-2">
                                    <h4 class="font-semibold text-slate-600 border-b pb-1">Fleet</h4>
                                    <div class="flex justify-between"><span>Owns Fleet:</span> <span class="font-semibold">${vendor.hasOwnFleet ? 'Yes' : 'No'}</span></div>
                                    <div class="flex justify-between"><span>Total Vehicles:</span> <span class="font-semibold">${vendor.vehicleCount || 'N/A'}</span></div>
                                </div>
                            </div>
                            <div class="mb-4">
                                <h4 class="text-sm font-semibold text-slate-600 border-b pb-1 mb-2">Vehicle Types</h4>
                                <ul class="text-sm space-y-1 text-slate-700 max-h-24 overflow-y-auto pr-2">${vehicleListHTML}</ul>
                            </div>
                            ${vendor.notes ? `<div class="mt-4 pt-2 border-t border-slate-200"><h4 class="text-sm font-semibold text-slate-600">Notes:</h4><p class="text-sm text-slate-600 whitespace-pre-wrap">${vendor.notes}</p></div>` : ''}
                        </div>
                        <div class="mt-6 text-right">
                            <button data-id="${vendor.id}" class="remove-btn text-sm font-medium text-red-600 hover:text-red-800">Remove Vendor</button>
                        </div>
                    </div>`;
                    vendorListContainer.innerHTML += card;
                });
            }
            updateDashboardStats(vendorList);
        };
        
        const openModal = () => vendorModal.classList.remove('hidden');
        const closeModal = () => vendorModal.classList.add('hidden');

        const exportToExcel = () => {
            if (vendors.length === 0) {
                alert("No vendor data to export.");
                return;
            }
            const dataForExport = vendors.map(vendor => ({
                'Vendor Name': vendor.vendorName,
                'City / Zone': vendor.cityZone,
                'Contact Number': vendor.contactNumber,
                'WhatsApp Number': vendor.whatsappNumber,
                'Year of Establishment': vendor.yearOfEstablishment,
                'GST Registered': vendor.isGstRegistered ? 'Yes' : 'No',
                'Owns Fleet': vendor.hasOwnFleet ? 'Yes' : 'No',
                'Total Vehicles': vendor.vehicleCount,
                'Vehicle Types': vendor.vehicleTypes && vendor.vehicleTypes.length > 0
                    ? vendor.vehicleTypes.map(v => `${v.type} (${v.count})`).join(', ')
                    : 'N/A',
                'Notes / Red Flags': vendor.notes
            }));
            const worksheet = XLSX.utils.json_to_sheet(dataForExport);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Vendors");
            XLSX.writeFile(workbook, "VendorDetails.xlsx");
        };

        addVendorForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitButton = e.target.querySelector('button[type="submit"]');
            submitButton.disabled = true;
            submitButton.textContent = 'Saving...';

            const collectedVehicleTypes = [...tempCustomVehicles];
            document.querySelectorAll('.vehicle-type-checkbox:checked').forEach(checkbox => {
                const type = checkbox.dataset.type;
                const countInput = document.querySelector(`input[data-type-count="${type}"]`);
                const count = parseInt(countInput.value) || 0;
                if (count > 0) collectedVehicleTypes.push({ type, count });
            });

            const newVendor = {
                vendorName: document.getElementById('vendorName').value,
                cityZone: document.getElementById('cityZone').value,
                contactNumber: document.getElementById('contactNumber').value,
                whatsappNumber: document.getElementById('whatsappNumber').value,
                yearOfEstablishment: document.getElementById('yearOfEstablishment').value,
                isGstRegistered: document.getElementById('isGstRegistered').checked,
                hasOwnFleet: document.getElementById('hasOwnFleet').checked,
                vehicleCount: document.getElementById('vehicleCount').value,
                vehicleTypes: collectedVehicleTypes,
                notes: document.getElementById('notes').value
            };

            try {
                await addDoc(vendorsCollection, newVendor);
                addVendorForm.reset();
                initializeVehicleForm();
                closeModal();
            } catch (error) {
                console.error("Error adding document: ", error);
                alert("Could not save vendor. Please try again.");
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Save Vendor';
            }
        });

        vendorListContainer.addEventListener('click', async (e) => {
            if (e.target.classList.contains('remove-btn')) {
                const docId = e.target.dataset.id;
                if (confirm('Are you sure you want to remove this vendor?')) {
                    try {
                        await deleteDoc(doc(db, "vendors", docId));
                    } catch (error) {
                        console.error("Error removing document: ", error);
                        alert("Could not remove vendor. Please try again.");
                    }
                }
            }
        });

        openModalBtn.addEventListener('click', openModal);
        closeModalBtn.addEventListener('click', closeModal);
        exportBtn.addEventListener('click', exportToExcel);

        vendorModal.addEventListener('click', (e) => {
            if (e.target === vendorModal) closeModal();
        });

        vehicleTypesContainer.addEventListener('change', (e) => {
            if(e.target.classList.contains('vehicle-type-checkbox')) {
                const type = e.target.dataset.type;
                const countInput = document.querySelector(`input[data-type-count="${type}"]`);
                countInput.disabled = !e.target.checked;
                if (!e.target.checked) countInput.value = '';
            }
        });

        addCustomVehicleBtn.addEventListener('click', () => {
            const nameInput = document.getElementById('customVehicleName');
            const countInput = document.getElementById('customVehicleCount');
            const name = nameInput.value.trim();
            const count = parseInt(countInput.value);
            if (name && count > 0) {
                tempCustomVehicles.push({ type: name, count: count });
                renderCustomVehicleTags();
                nameInput.value = '';
                countInput.value = '';
            }
        });

        const renderCustomVehicleTags = () => {
            customVehicleTagsContainer.innerHTML = '';
            tempCustomVehicles.forEach((vehicle, index) => {
                const tag = document.createElement('div');
                tag.className = 'bg-blue-100 text-blue-800 text-xs font-medium pl-2 pr-1 py-1 rounded-full flex items-center gap-1';
                tag.innerHTML = `
                    <span>${vehicle.type} (${vehicle.count})</span>
                    <button type="button" data-index="${index}" class="remove-custom-vehicle-btn font-bold text-blue-600 hover:text-blue-800">&times;</button>
                `;
                customVehicleTagsContainer.appendChild(tag);
            });
        };

        customVehicleTagsContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('remove-custom-vehicle-btn')) {
                const indexToRemove = parseInt(e.target.dataset.index);
                tempCustomVehicles.splice(indexToRemove, 1);
                renderCustomVehicleTags();
            }
        });

        initializeVehicleForm();
    </script>
</body>
</html>

